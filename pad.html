<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAL Well Detail</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        /* 5-Column Responsive Grid */
        #wellsGrid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 28px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        @media (max-width: 1400px) { #wellsGrid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 1100px) { #wellsGrid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 800px)  { #wellsGrid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px)  { #wellsGrid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <h1 id="padTitle">PAD?</h1>
        <p id="palSubtitle">Well Control Center</p>
        <button onclick="history.back()" class="back-btn">Back to Dashboard</button>
    </header>

    <!-- 5-Column Grid -->
    <div id="wellsGrid">
        <!-- Wells will be injected here -->
    </div>

    <div style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    text-align: center;
">
    <button onclick="addNewWell()" class="add-btn" 
        style="padding:10px 10px; font-size:0.7rem; border-radius:16px;">
        + Add New Well
    </button>
</div>

    <!-- Status Menu -->
    <div id="statusMenu" class="status-menu">
        <div class="menu-item" data-status="normal">Normal</div>
        <div class="menu-item" data-status="warning">Warning</div>
        <div class="menu-item" data-status="critical">Critical</div>
        <div class="menu-item" data-status="rename">Rename Well</div>
    </div>

    <!-- Comment Sidebar -->
    <div id="commentSidebar" class="comment-sidebar">
        <div class="sidebar-header">
            <h3 id="sidebarWellName">Well Comments</h3>
            <button onclick="padController.closeSidebar()" class="close-btn">×</button>
        </div>
        <div class="comments-list" id="commentsList"></div>
        <div class="comment-input">
            <textarea id="newComment" placeholder="Add comment..."></textarea>
            <button onclick="padController.addComment()" class="add-btn">Add</button>
        </div>
    </div>
    <div id="overlay" class="overlay" onclick="padController.closeSidebar()"></div>

    <div id="addWellModal" class="modal">
  <div class="modal-content">
    <h3>Yamski Kusgan! joke</h3>
    <input type="text" id="newWellInput" placeholder="Enter well name (e.g. PN25D)">
    <div class="modal-buttons">
      <button id="cancelAddWell">Cancel</button>
      <button id="confirmAddWell">Add</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC52QTguwvdZQ4r5z-JC_UOmeiI7CUvp9Q",
    authDomain: "pad-dashboard-example.firebaseapp.com",
    projectId: "pad-dashboard-example",
    storageBucket: "pad-dashboard-example.firebasestorage.app",
    messagingSenderId: "875327896050",
    appId: "1:875327896050:web:8989a3b3cf17795bd4d36b",
    measurementId: "G-EQS42K5F88"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  window.db = getDatabase(app); // <-------- IMPORTANT
</script>


    <script src="js/pad.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const pad = urlParams.get('pad');
        const pal = urlParams.get('pal');
        if (!pad || !pal) { document.body.innerHTML = "<h1 style='color:red;text-align:center;margin-top:100px'>Invalid PAD</h1>"; }

        document.getElementById('padTitle').textContent = pad;
        document.getElementById('palSubtitle').textContent = `PAL ${pal} - Well Control Center`;

        const grid = document.getElementById('wellsGrid');
        const prefix = pal === '2' ? 'PAL2_' : '';
        let padController;

        function getWells() {
            return JSON.parse(localStorage.getItem(`customWells_${pad}`) || '[]');
        }
        function saveWells(wells) {
            localStorage.setItem(`customWells_${pad}`, JSON.stringify(wells));
        }

        function renderWells() {
            const wells = getWells();
            grid.innerHTML = wells.length === 0 
                ? '<div style="grid-column:1/-1;text-align:center;color:#94a3b8;font-size:1.8rem;margin:80px 0;">No wells yet — click "+ Add New Well" below</div>'
                : '';

            wells.forEach(wellName => {
                const card = document.createElement('div');
                card.className = 'well-card normal';
                card.dataset.well = wellName;
                card.innerHTML = `
                    <span style="font-size:3.4rem;font-weight:900;letter-spacing:3px;">${wellName}</span>
                    <button onclick="event.stopPropagation(); removeWell('${wellName}')" 
                            style="position:absolute;top:12px;right:12px;background:#ef4444;color:white;border:none;border-radius:50%;width:42px;height:42px;font-size:1.8rem;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.3);">
                        ×
                    </button>
                `;
                grid.appendChild(card);
            });

            // Re-attach controller so new cards are clickable
            padController = new PadController(prefix);
        }

        window.addNewWell = function() {
const modal = document.getElementById('addWellModal');
const input = document.getElementById('newWellInput');
modal.style.display = 'flex';
input.value = '';
input.focus();

document.getElementById('cancelAddWell').onclick = () => {
    modal.style.display = 'none';
};

document.getElementById('confirmAddWell').onclick = () => {
    const name = input.value.trim().toUpperCase();
    if (!name) {
        alert("Please enter a well name.");
        return;
    }
    const wells = getWells();
    if (wells.includes(name)) {
        alert("Well already exists!");
        return;
    }
    wells.push(name);
    saveWells(wells);
    renderWells();
    modal.style.display = 'none';
};

};

        window.removeWell = function(wellName) {
    if (confirm(`Delete "${wellName}" permanently from ${pad}?`)) {
        // 1. Remove from wells array
        const wells = getWells().filter(w => w !== wellName);
        saveWells(wells);

        // 2. Remove well-specific comments
        localStorage.removeItem(`${prefix}comments_${pad}_${wellName}`);

        // 3. Remove well from main wellStatus object
        const statusKey = `${prefix}wellStatus_${pad}`;
        let allStatuses = JSON.parse(localStorage.getItem(statusKey) || '{}');
        if (allStatuses[wellName]) delete allStatuses[wellName];
        localStorage.setItem(statusKey, JSON.stringify(allStatuses));

        // 4. Re-render
        renderWells();
    }
};


        renderWells();
    </script>
</body>
</html>
